<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ананас: Прыжки</title>
    <style>
    body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #87CEEB;
        overflow: hidden;
    }
    #game-container {
        border: 1px solid black;
    }
    .button {
        position: absolute;
        width: 60px;
        height: 60px;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        text-align: center;
        line-height: 60px;
        font-size: 20px;
        border-radius: 10px;
        user-select: none;
        touch-action: none;
    }
    #leftButton { bottom: 20px; left: 20px; }
    #rightButton { bottom: 20px; left: 100px; }
    #jumpButton { bottom: 20px; right: 20px; }
    #menu, #settings-menu, #about-menu {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('https://i.postimg.cc/Rq52Jzfs/2024081220731.jpg') no-repeat center center;
        background-size: cover;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        font-family: Arial, sans-serif;
    }
    #settings-menu, #about-menu {
        background: url('https://i.postimg.cc/hG3sLp6n/2024085220039.jpg') no-repeat center center;
        background-size: cover;
        display: none;
    }
    #menu h1 {
        color: black;
        text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
    }
    #settings-menu h1, #about-menu h1 {
        color: white; /* Делаем текст белым */
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); /* Меняем тень на чёрную для контраста */
    }
    #menu button, #settings-menu button, #about-menu button {
        padding: 10px 20px;
        font-size: 18px;
        margin: 10px;
        cursor: pointer;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 5px;
    }
    #game-over, #win-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
    }
    #game-over button, #win-screen button {
        padding: 10px 20px;
        font-size: 18px;
        margin: 10px;
        cursor: pointer;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 5px;
    }
    #settings-menu label {
        font-size: 18px;
        margin: 10px;
        color: white;
        text-shadow: 1px 1px 2px black;
    }
    #settings-menu input[type="range"] {
        width: 200px;
    }
</style>
</head>
<body>
    <div id="game-container"></div>
    <div id="leftButton" class="button">←</div>
    <div id="rightButton" class="button">→</div>
    <div id="jumpButton" class="button">↑</div>
    <div id="menu">
        <h1>Ананас: Прыжки</h1>
        <button onclick="startLevel(1)">Уровень 1</button>
        <button onclick="startLevel(2)">Уровень 2</button>
        <button onclick="startLevel(3)">Уровень 3</button>
        <button onclick="startLevel(4)">Уровень 4</button>
        <button onclick="startRandomLevel()">Генератор уровней</button>
        <button onclick="openSettings()">Настройки</button>
        <button onclick="openAbout()">Об игре</button>
    </div>
    <div id="settings-menu">
        <h1>Настройки</h1>
        <label for="music-volume">Громкость музыки:</label>
        <input type="range" id="music-volume" min="0" max="1" step="0.1" value="0.5" oninput="adjustMusicVolume(this.value)">
        <label for="sfx-volume">Громкость звуков:</label>
        <input type="range" id="sfx-volume" min="0" max="1" step="0.1" value="0.5" oninput="adjustSfxVolume(this.value)">
        <button onclick="backToMenu()">Назад</button>
    </div>
    <div id="about-menu">
        <h1>Об игре</h1>
        <p>Авторы игры:</p>
        <p>Ананас и нейросеть Grok 3</p>
        <button onclick="backToMenu()">Назад</button>
    </div>
    <div id="game-over">
        <h1>Game Over</h1>
        <button onclick="restartLevel()">Начать заново</button>
    </div>
    <div id="win-screen">
        <h1>You Win!</h1>
        <p id="time-display"></p>
        <button onclick="returnToMenu()">Вернуться в меню</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 300 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            }
        };

        let player;
        let platforms;
        let spikes;
        let finish;
        let gameStarted = false;
        let jumpCount = 0;
        const maxJumps = 2;
        let isJumping = false;
        let startTime;
        let elapsedTime;
        let currentLevel = 1;
        let isRandomLevel = false;
        let backgroundMusic;
        let menuMusic;
        let settingsMusic;
        let aboutMusic;
        let buttonClickSound;
        let gameOverSound;
        let winSound;
        let jumpSound;
        let musicVolume = 0.5;
        let sfxVolume = 0.5;

        const game = new Phaser.Game(config);

        function preload() {
            this.load.image('pineapple', 'https://i.postimg.cc/jdc3cccf/20250321-114920.png');
            this.load.image('background1', 'https://i.postimg.cc/C16Gt6tN/130-20250322154451.png');
            this.load.image('background2', 'https://i.postimg.cc/BbHLqqNm/130-20250322155052.png');
            this.load.image('background3', 'https://i.postimg.cc/8z1JSgvb/130-20250322155201.png');
            this.load.image('background4', 'https://i.postimg.cc/zG0LD2SY/130-20250322155359.png');
            this.load.image('platform', 'https://i.postimg.cc/rwnrR3gC/ce80c5c3db6e9b7.png');
            this.load.image('spike', 'https://i.postimg.cc/QMgZyGPc/2daea9f37ca2c48.png');
            this.load.image('finish', 'https://i.postimg.cc/YSLhG9vM/542c5a903add587.png');
            // Звуки и музыка с GitHub Pages
            this.load.audio('buttonClick', 'https://ahahachahahahahahaah.github.io/game/button.mp3');
            this.load.audio('gameOver', 'https://ahahachahahahahahaah.github.io/game/game_over.mp3');
            this.load.audio('win', 'https://ahahachahahahahahaah.github.io/game/win.mp3');
            this.load.audio('menuMusic', 'https://ahahachahahahahahaah.github.io/game/menu.mp3');
            this.load.audio('levelMusic', 'https://ahahachahahahahahaah.github.io/game/level.mp3');
            this.load.audio('settingsMusic', 'https://ahahachahahahahahaah.github.io/game/settings.mp3');
            this.load.audio('aboutMusic', 'https://ahahachahahahahahaah.github.io/game/about.mp3');
            this.load.audio('jumpSound', 'https://ahahachahahahahahaah.github.io/game/jump.mp3');

            // Отладка загрузки аудио
            this.load.on('filecomplete', (key) => {
                console.log(`Файл загружен: ${key}`);
            });
            this.load.on('loaderror', (file) => {
                console.error(`Ошибка загрузки файла: ${file.key}`);
            });
        }

        function create() {
            if (!gameStarted) {
                // Инициализируем музыку меню при первом запуске сцены
                if (!menuMusic) {
                    menuMusic = this.sound.add('menuMusic', { loop: true, volume: musicVolume });
                    console.log("menuMusic инициализирован");
                }
                if (!menuMusic.isPlaying) {
                    menuMusic.play();
                    console.log("menuMusic воспроизводится");
                }
                return;
            }

            // Устанавливаем размеры мира
            this.physics.world.setBounds(0, 0, 3000, 600);

            // Выбираем фон
            let backgroundKey;
            if (isRandomLevel) {
                const randomBackground = Phaser.Math.Between(1, 4);
                backgroundKey = `background${randomBackground}`;
            } else {
                backgroundKey = `background${currentLevel}`;
            }
            let background = this.add.image(0, 0, backgroundKey).setOrigin(0, 0);
            background.displayWidth = 3000;
            background.displayHeight = 600;

            // Создаём платформы
            platforms = this.physics.add.staticGroup();
            if (isRandomLevel) {
                for (let x = 0; x < 3000; x += 300) {
                    platforms.create(x + 150, 550, 'platform').setScale(0.5).refreshBody();
                }
                for (let i = 0; i < 8; i++) {
                    const x = Phaser.Math.Between(400, 2600);
                    const y = Phaser.Math.Between(200, 450);
                    platforms.create(x, y, 'platform').setScale(0.3).refreshBody();
                }
            } else {
                for (let x = 0; x < 3000; x += 300) {
                    platforms.create(x + 150, 550, 'platform').setScale(0.5).refreshBody();
                }
                if (currentLevel === 1) {
                    platforms.create(600, 400, 'platform').setScale(0.3).refreshBody();
                    platforms.create(50, 250, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1200, 300, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1800, 400, 'platform').setScale(0.3).refreshBody();
                    platforms.create(2400, 350, 'platform').setScale(0.3).refreshBody();
                } else if (currentLevel === 2) {
                    platforms.create(400, 350, 'platform').setScale(0.3).refreshBody();
                    platforms.create(800, 250, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1400, 400, 'platform').setScale(0.3).refreshBody();
                    platforms.create(2000, 300, 'platform').setScale(0.3).refreshBody();
                    platforms.create(2600, 450, 'platform').setScale(0.3).refreshBody();
                } else if (currentLevel === 3) {
                    platforms.create(400, 450, 'platform').setScale(0.3).refreshBody();
                    platforms.create(700, 350, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1000, 250, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1300, 400, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1600, 300, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1900, 450, 'platform').setScale(0.3).refreshBody();
                    platforms.create(2200, 350, 'platform').setScale(0.3).refreshBody();
                    platforms.create(2500, 250, 'platform').setScale(0.3).refreshBody();
                } else if (currentLevel === 4) {
                    platforms.create(500, 450, 'platform').setScale(0.3).refreshBody();
                    platforms.create(900, 350, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1300, 250, 'platform').setScale(0.3).refreshBody();
                    platforms.create(1700, 400, 'platform').setScale(0.3).refreshBody();
                    platforms.create(2500, 300, 'platform').setScale(0.3).refreshBody();
                }
            }

            // Создаём шипы
            spikes = this.physics.add.staticGroup();
            if (isRandomLevel) {
                for (let i = 0; i < 5; i++) {
                    const x = Phaser.Math.Between(600, 2600);
                    spikes.create(x, 500, 'spike').setScale(0.2).refreshBody();
                }
            } else {
                if (currentLevel === 1) {
                    spikes.create(800, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1000, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1500, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(2000, 500, 'spike').setScale(0.2).refreshBody();
                } else if (currentLevel === 2) {
                    spikes.create(600, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1200, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1800, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(2400, 500, 'spike').setScale(0.2).refreshBody();
                } else if (currentLevel === 3) {
                    spikes.create(600, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(900, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1200, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1800, 500, 'spike').setScale(0.2).refreshBody();
                } else if (currentLevel === 4) {
                    spikes.create(700, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1100, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(1600, 500, 'spike').setScale(0.2).refreshBody();
                    spikes.create(2600, 500, 'spike').setScale(0.2).refreshBody();
                }
            }

            // Создаём финиш
            finish = this.physics.add.staticSprite(2800, 450, 'finish').setScale(0.2).refreshBody();

            // Создаём ананас
            player = this.physics.add.sprite(400, 450, 'pineapple');
            player.setScale(0.1);
            player.setBounce(0.2);
            player.setCollideWorldBounds(true);
            player.body.setSize(player.width * 0.8, player.height * 0.8);

            // Настраиваем камеру
            this.cameras.main.setBounds(0, 0, 3000, 600);
            this.cameras.main.startFollow(player, true, 0.1, 0.1);

            // Столкновения
            this.physics.add.collider(player, platforms, () => {
                jumpCount = 0;
                console.log("Коснулся платформы, jumpCount сброшен:", jumpCount);
            });
            this.physics.add.overlap(player, spikes, gameOver, null, this);
            this.physics.add.overlap(player, finish, winLevel, null, this);

            // Сбрасываем счётчик прыжков при старте уровня
            jumpCount = 0;

            // Запускаем таймер
            startTime = this.time.now;

            // Инициализируем звуки
            buttonClickSound = this.sound.add('buttonClick', { volume: sfxVolume });
            gameOverSound = this.sound.add('gameOver', { volume: sfxVolume });
            winSound = this.sound.add('win', { volume: sfxVolume });
            jumpSound = this.sound.add('jumpSound', { volume: sfxVolume });

            // Останавливаем музыку меню и настроек
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();

            // Воспроизводим музыку уровня
            if (!backgroundMusic) {
                backgroundMusic = this.sound.add('levelMusic', { loop: true, volume: musicVolume });
            }
            if (!backgroundMusic.isPlaying) {
                backgroundMusic.play();
            }

            setupTouchControls(this);
        }

        function update() {
            if (!gameStarted) return;

            const cursors = this.input.keyboard.createCursorKeys();

            // Управление движением
            if (cursors.left.isDown || isTouchingLeft) {
                player.setVelocityX(-160);
            } else if (cursors.right.isDown || isTouchingRight) {
                player.setVelocityX(160);
            } else {
                player.setVelocityX(0);
            }

            // Прыжок
            if ((cursors.up.isDown || isTouchingJump) && !isJumping && jumpCount < maxJumps) {
                player.setVelocityY(-330);
                jumpCount++;
                isJumping = true;
                if (jumpSound) jumpSound.play();
                console.log("Прыжок! jumpCount:", jumpCount);
            }

            // Сбрасываем флаг прыжка, когда кнопка отпущена
            if (!cursors.up.isDown && !isTouchingJump) {
                isJumping = false;
            }
        }

        // Логика сенсорных кнопок
        let isTouchingLeft = false;
        let isTouchingRight = false;
        let isTouchingJump = false;

        function setupTouchControls(scene) {
            const leftButton = document.getElementById('leftButton');
            const rightButton = document.getElementById('rightButton');
            const jumpButton = document.getElementById('jumpButton');

            leftButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouchingLeft = true;
            });
            leftButton.addEventListener('touchend', () => {
                isTouchingLeft = false;
            });

            rightButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouchingRight = true;
            });
            rightButton.addEventListener('touchend', () => {
                isTouchingRight = false;
            });

            jumpButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouchingJump = true;
            });
            jumpButton.addEventListener('touchend', () => {
                isTouchingJump = false;
            });
        }

        // Game Over
        function gameOver(player, spike) {
            this.physics.pause();
            gameStarted = false;
            if (backgroundMusic && backgroundMusic.isPlaying) backgroundMusic.stop();
            if (gameOverSound) gameOverSound.play();
            document.getElementById('game-over').style.display = 'flex';
        }

        // Win Level
        function winLevel(player, finish) {
            this.physics.pause();
            gameStarted = false;
            if (backgroundMusic && backgroundMusic.isPlaying) backgroundMusic.stop();
            if (winSound) winSound.play();
            elapsedTime = (this.time.now - startTime) / 1000;
            document.getElementById('time-display').innerText = `Время: ${elapsedTime.toFixed(2)} сек`;
            document.getElementById('win-screen').style.display = 'flex';
        }

        // Перезапуск уровня
        function restartLevel() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('game-over').style.display = 'none';
            gameStarted = true;
            game.scene.scenes[0].scene.restart();
        }

        // Возврат в меню
        function returnToMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('win-screen').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('about-menu').style.display = 'none';
            gameStarted = false;
            isRandomLevel = false;
            if (backgroundMusic && backgroundMusic.isPlaying) backgroundMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (!menuMusic) {
                menuMusic = game.sound.add('menuMusic', { loop: true, volume: musicVolume });
            }
            if (!menuMusic.isPlaying) {
                menuMusic.play();
            }
        }

        // Открытие настроек
        function openSettings() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('settings-menu').style.display = 'flex';
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (!settingsMusic) {
                settingsMusic = game.sound.add('settingsMusic', { loop: true, volume: musicVolume });
            }
            if (!settingsMusic.isPlaying) {
                settingsMusic.play();
            }
        }

        // Открытие меню "Об игре"
        function openAbout() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('about-menu').style.display = 'flex';
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (!aboutMusic) {
                aboutMusic = game.sound.add('aboutMusic', { loop: true, volume: musicVolume });
            }
            if (!aboutMusic.isPlaying) {
                aboutMusic.play();
            }
        }

        // Назад в меню
        function backToMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('about-menu').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (!menuMusic) {
                menuMusic = game.sound.add('menuMusic', { loop: true, volume: musicVolume });
            }
            if (!menuMusic.isPlaying) {
                menuMusic.play();
            }
        }

        // Регулировка громкости музыки
        function adjustMusicVolume(value) {
            musicVolume = parseFloat(value);
            if (backgroundMusic) backgroundMusic.setVolume(musicVolume);
            if (menuMusic) menuMusic.setVolume(musicVolume);
            if (settingsMusic) settingsMusic.setVolume(musicVolume);
            if (aboutMusic) aboutMusic.setVolume(musicVolume);
        }

        // Регулировка громкости звуков
        function adjustSfxVolume(value) {
            sfxVolume = parseFloat(value);
            if (buttonClickSound) buttonClickSound.setVolume(sfxVolume);
            if (gameOverSound) gameOverSound.setVolume(sfxVolume);
            if (winSound) winSound.setVolume(sfxVolume);
            if (jumpSound) jumpSound.setVolume(sfxVolume);
        }

        // Запуск уровня
        function startLevel(level) {
            if (buttonClickSound) buttonClickSound.play();
            currentLevel = level;
            isRandomLevel = false;
            gameStarted = true;
            document.getElementById('menu').style.display = 'none';
            game.scene.scenes[0].scene.restart();
        }

        // Запуск случайного уровня
        function startRandomLevel() {
            if (buttonClickSound) buttonClickSound.play();
            isRandomLevel = true;
            gameStarted = true;
            document.getElementById('menu').style.display = 'none';
            game.scene.scenes[0].scene.restart();
        }
    </script>
</body>
</html>