<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ананас: Прыжки</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #87CEEB;
            overflow: hidden;
        }
        #game-container {
            border: 1px solid black;
            position: relative;
        }
        .button {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            text-align: center;
            line-height: 60px;
            font-size: 20px;
            border-radius: 10px;
            user-select: none;
            touch-action: none;
        }
        #leftButton { bottom: 20px; left: 20px; }
        #rightButton { bottom: 20px; left: 100px; }
        #jumpButton { bottom: 20px; right: 20px; }
        #menu, #settings-menu, #about-menu, #skin-menu, #create-level-menu, #level-name-menu, #background-menu, #level-editor {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://i.postimg.cc/Rq52Jzfs/2024081220731.jpg') no-repeat center center;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-family: Arial, sans-serif;
        }
        #settings-menu, #about-menu {
            background: url('https://i.postimg.cc/hG3sLp6n/2024085220039.jpg') no-repeat center center;
            background-size: cover;
        }
        #skin-menu {
            background: url('https://i.postimg.cc/HnsMqD6x/2024085124240.jpg') no-repeat center center;
            background-size: cover;
        }
       
        }
        #level-editor {
            background: none;
            justify-content: flex-start;
            padding-top: 20px;
            z-index: 10;
        }
        #settings-menu, #about-menu, #skin-menu, #create-level-menu, #level-name-menu, #background-menu, #level-editor {
            display: none;
        }
        #menu h1 {
            color: black;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
        }
        #settings-menu h1, #about-menu h1, #skin-menu h1, #create-level-menu h1, #level-name-menu h1, #background-menu h1, #level-editor h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        #menu button, #settings-menu button, #about-menu button, #skin-menu button, #create-level-menu button, #level-name-menu button, #background-menu button, #level-editor button {
            padding: 10px 20px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 5px;
        }
        .skin-option, .background-option {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .skin-preview, .background-preview {
            width: 100px;
            height: 60px;
            margin-right: 10px;
            border: 2px solid white;
            border-radius: 5px;
        }
        #game-over, #win-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #game-over button, #win-screen button {
            padding: 10px 20px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 5px;
        }
        #settings-menu label, #create-level-menu label, #level-name-menu label {
            font-size: 18px;
            margin: 10px;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        #settings-menu input[type="range"], #create-level-menu input, #level-name-menu input {
            width: 200px;
            padding: 10px;
            font-size: 16px;
            margin: 10px;
            border-radius: 5px;
            border: none;
        }
        #level-editor h1 {
            margin: 0;
        }
        #editor-menu-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        #editor-buttons {
            position: absolute;
            top: 70px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #elements-panel {
            position: absolute;
            bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            z-index: 20;
        }
        .element-image {
            width: 50px;
            height: 50px;
            cursor: pointer;
            border: 2px solid white;
            border-radius: 5px;
        }
        .element-image:hover {
            border-color: yellow;
        }
        #game-container canvas {
            z-index: 0;
        }
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(rgba(255, 255, 255, 0.2) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(255, 255, 255, 0.2) 1px, transparent 1px);
            background-size: 32px 32px;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <div id="leftButton" class="button">←</div>
    <div id="rightButton" class="button">→</div>
    <div id="jumpButton" class="button">↑</div>
    <div id="menu">
        <h1>Ананас: Прыжки</h1>
        <button id="level1-btn">Уровень 1</button>
        <button id="level2-btn">Уровень 2</button>
        <button id="level3-btn">Уровень 3</button>
        <button id="level4-btn">Уровень 4</button>
        <button id="random-level-btn">Генератор уровней</button>
        <button id="create-level-btn">Создать уровень</button>
        <button id="skin-menu-btn">Выбор скина</button>
        <button id="settings-btn">Настройки</button>
    </div>
    <div id="settings-menu">
        <h1>Настройки</h1>
        <label for="music-volume">Громкость музыки:</label>
        <input type="range" id="music-volume" min="0" max="1" step="0.1" value="0.5">
        <label for="sfx-volume">Громкость звуков:</label>
        <input type="range" id="sfx-volume" min="0" max="1" step="0.1" value="0.5">
        <button id="about-btn">Об игре</button>
        <button id="settings-back-btn">Назад</button>
    </div>
    <div id="about-menu">
        <h1>Об игре</h1>
        <p>Авторы игры:</p>
        <p>Ананас и нейросеть Grok 3</p>
        <button id="about-back-btn">Назад</button>
    </div>
    <div id="skin-menu">
        <h1>Выбор скина</h1>
        <div class="skin-option">
            <img src="https://i.postimg.cc/jdc3cccf/20250321-114920.png" alt="Скин 1" class="skin-preview">
            <button id="skin1-btn">Скин 1</button>
        </div>
        <div class="skin-option">
            <img src="https://i.postimg.cc/QNkWjt7y/Clipped-image-20250305-181458.png" alt="Скин 2" class="skin-preview">
            <button id="skin2-btn">Скин 2</button>
        </div>
        <div class="skin-option">
            <img src="https://i.postimg.cc/3JFjf19W/Clipped-image-20250321-121502.png" alt="Скин 3" class="skin-preview">
            <button id="skin3-btn">Скин 3</button>
        </div>
        <div class="skin-option">
            <img src="https://i.postimg.cc/WpM0t8BS/Clipped-image-20250323-113913.png" alt="Скин 4" class="skin-preview">
            <button id="skin4-btn">Скин 4</button>
        </div>
        <button id="skin-back-btn">Назад</button>
    </div>
    <div id="create-level-menu">
        <h1>Создание уровня</h1>
        <label for="level-code-input">Код уровня:</label>
        <input type="text" id="level-code-input" placeholder="Введите код уровня">
        <button id="load-level-btn">Создать уровень</button>
        <button id="new-level-btn">Создать новый уровень</button>
        <button id="create-level-back-btn">Назад</button>
    </div>
    <div id="level-name-menu">
        <h1>Название уровня</h1>
        <label for="level-name-input">Введите название:</label>
        <input type="text" id="level-name-input" placeholder="Название уровня">
        <button id="level-name-next-btn">Далее</button>
        <button id="level-name-back-btn">Назад</button>
    </div>
    <div id="background-menu">
        <h1>Выбор фона</h1>
        <div class="background-option">
            <img src="https://i.postimg.cc/C16Gt6tN/130-20250322154451.png" alt="Фон 1" class="background-preview">
            <button id="bg1-btn">Фон 1</button>
        </div>
        <div class="background-option">
            <img src="https://i.postimg.cc/BbHLqqNm/130-20250322155052.png" alt="Фон 2" class="background-preview">
            <button id="bg2-btn">Фон 2</button>
        </div>
        <div class="background-option">
            <img src="https://i.postimg.cc/8z1JSgvb/130-20250322155201.png" alt="Фон 3" class="background-preview">
            <button id="bg3-btn">Фон 3</button>
        </div>
        <div class="background-option">
            <img src="https://i.postimg.cc/zG0LD2SY/130-20250322155359.png" alt="Фон 4" class="background-preview">
            <button id="bg4-btn">Фон 4</button>
        </div>
        <button id="bg-back-btn">Назад</button>
    </div>
    <div id="level-editor">
        <h1>Редактор уровня</h1>
        <button id="editor-menu-btn">Вернуться в меню</button>
        <div id="editor-buttons">
            <button id="undo-btn">Отменить</button>
            <button id="redo-btn">Повторить</button>
            <button id="clear-all-btn">Очистить всё</button>
            <button id="toggle-grid-btn">Вкл/Выкл сетку</button>
            <button id="copy-code-btn">Скопировать код</button>
        </div>
        <div id="elements-panel">
            <img src="https://i.postimg.cc/rwnrR3gC/ce80c5c3db6e9b7.png" alt="platform" class="element-image" data-type="platform">
            <img src="https://i.postimg.cc/kG31cMCk/20250323-141207.png" alt="deadlyPlatform1" class="element-image" data-type="deadlyPlatform1">
            <img src="https://i.postimg.cc/VsnHNtB1/20250323-141244.png" alt="deadlyPlatform2" class="element-image" data-type="deadlyPlatform2">
            <img src="https://i.postimg.cc/QMgZyGPc/2daea9f37ca2c48.png" alt="spike" class="element-image" data-type="spike">
            <img src="https://i.postimg.cc/MTqJVR0C/132-20250323121142.png" alt="coin" class="element-image" data-type="coin">
            <img src="https://i.postimg.cc/jdc3cccf/20250321-114920.png" alt="start" class="element-image" data-type="start">
            <img src="https://i.postimg.cc/YSLhG9vM/542c5a903add587.png" alt="finish" class="element-image" data-type="finish">
        </div>
    </div>
    <div id="game-over">
        <h1>Game Over</h1>
        <button id="restart-btn">Начать заново</button>
    </div>
    <div id="win-screen">
        <h1>You Win!</h1>
        <p id="time-display"></p>
        <p id="coins-display"></p>
        <button id="return-to-menu-btn">Вернуться в меню</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 300 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            render: {
                willReadFrequently: true
            }
        };

        let player;
        let platforms;
        let deadlyPlatforms1;
        let deadlyPlatforms2;
        let spikes;
        let coins;
        let finish;
        let gameStarted = false;
        let jumpCount = 0;
        const maxJumps = 2;
        let isJumping = false;
        let startTime;
        let elapsedTime;
        let collectedCoins = 0;
        let currentLevel = 1;
        let isRandomLevel = false;
        let backgroundMusic;
        let menuMusic;
        let settingsMusic;
        let aboutMusic;
        let skinMenuMusic;
        let editorMusic;
        let buttonClickSound;
        let gameOverSound;
        let winSound;
        let jumpSound;
        let coinSound;
        let musicVolume = 0.5;
        let sfxVolume = 0.5;
        let selectedSkin = 'pineapple1';
        let levelName = '';
        let selectedBackground = 'background1';
        let levelData = {
            background: 'background1',
            elements: []
        };
        let levelCode = '';
        let customLevel = false;

        const game = new Phaser.Game(config);

        function preload() {
            this.load.image('pineapple1', 'https://i.postimg.cc/jdc3cccf/20250321-114920.png');
            this.load.image('pineapple2', 'https://i.postimg.cc/QNkWjt7y/Clipped-image-20250305-181458.png');
            this.load.image('pineapple3', 'https://i.postimg.cc/3JFjf19W/Clipped-image-20250321-121502.png');
            this.load.image('pineapple4', 'https://i.postimg.cc/WpM0t8BS/Clipped-image-20250323-113913.png');
            this.load.image('background1', 'https://i.postimg.cc/C16Gt6tN/130-20250322154451.png');
            this.load.image('background2', 'https://i.postimg.cc/BbHLqqNm/130-20250322155052.png');
            this.load.image('background3', 'https://i.postimg.cc/8z1JSgvb/130-20250322155201.png');
            this.load.image('background4', 'https://i.postimg.cc/zG0LD2SY/130-20250322155359.png');
            this.load.image('platform', 'https://i.postimg.cc/rwnrR3gC/ce80c5c3db6e9b7.png');
            this.load.image('deadlyPlatform1', 'https://i.postimg.cc/kG31cMCk/20250323-141207.png');
            this.load.image('deadlyPlatform2', 'https://i.postimg.cc/VsnHNtB1/20250323-141244.png');
            this.load.image('spike', 'https://i.postimg.cc/QMgZyGPc/2daea9f37ca2c48.png');
            this.load.image('finish', 'https://i.postimg.cc/YSLhG9vM/542c5a903add587.png');
            this.load.image('coin', 'https://i.postimg.cc/MTqJVR0C/132-20250323121142.png');
            this.load.audio('buttonClick', 'https://ahahachahahahahahaah.github.io/game/button.mp3');
            this.load.audio('gameOver', 'https://ahahachahahahahahaah.github.io/game/game_over.mp3');
            this.load.audio('win', 'https://ahahachahahahahahaah.github.io/game/win.mp3');
            this.load.audio('menuMusic', 'https://ahahachahahahahahaah.github.io/game/menu.mp3');
            this.load.audio('levelMusic', 'https://ahahachahahahahahaah.github.io/game/level.mp3');
            this.load.audio('settingsMusic', 'https://ahahachahahahahahaah.github.io/game/settings.mp3');
            this.load.audio('aboutMusic', 'https://ahahachahahahahahaah.github.io/game/about.mp3');
            this.load.audio('skinMenuMusic', 'https://ahahachahahahahahaah.github.io/game/about.mp3');
            this.load.audio('editorMusic', 'https://ahahachahahahahahaah.github.io/game/editor.mp3');
            this.load.audio('jumpSound', 'https://ahahachahahahahahaah.github.io/game/jump.mp3');
            this.load.audio('coinSound', 'https://ahahachahahahahahaah.github.io/game/coin.mp3');

            this.load.on('filecomplete', (key) => {
                console.log(`Файл загружен: ${key}`);
            });
            this.load.on('loaderror', (file) => {
                console.error(`Ошибка загрузки файла: ${file.key}`);
            });
        }

        function checkCoinOverlap(player, coins) {
            const playerBounds = player.getBounds();
            coins.getChildren().forEach(coin => {
                if (!coin.active) return;
                const coinBounds = coin.getBounds();
                if (Phaser.Geom.Intersects.RectangleToRectangle(playerBounds, coinBounds)) {
                    coin.setActive(false).setVisible(false);
                    collectedCoins++;
                    if (coinSound) coinSound.play();
                    console.log(`Монета собрана! Всего монет: ${collectedCoins}`);
                }
            });
        }

        function create() {
            if (!gameStarted) {
                if (!menuMusic) {
                    menuMusic = this.sound.add('menuMusic', { loop: true, volume: musicVolume });
                    console.log("menuMusic инициализирован");
                }
                if (!menuMusic.isPlaying) {
                    menuMusic.play();
                    console.log("menuMusic воспроизводится");
                }
                return;
            }

            collectedCoins = 0;
            this.physics.world.setBounds(0, 0, 3000, 600);

            let backgroundKey;
            if (customLevel) {
                backgroundKey = levelData.background;
            } else if (isRandomLevel) {
                const randomBackground = Phaser.Math.Between(1, 4);
                backgroundKey = `background${randomBackground}`;
            } else {
                backgroundKey = `background${currentLevel}`;
            }
            let background = this.add.image(0, 0, backgroundKey).setOrigin(0, 0);
            background.displayWidth = 3000;
            background.displayHeight = 600;
            background.setDepth(0);

            platforms = this.physics.add.staticGroup();
            deadlyPlatforms1 = this.physics.add.staticGroup();
            deadlyPlatforms2 = this.physics.add.staticGroup();
            spikes = this.physics.add.staticGroup();
            coins = this.add.group();

            if (customLevel) {
                levelData.elements.forEach(element => {
                    if (element.type === 'platform') {
                        platforms.create(element.x, element.y, 'platform').setScale(element.scale).refreshBody().setDepth(2);
                    } else if (element.type === 'deadlyPlatform1') {
                        deadlyPlatforms1.create(element.x, element.y, 'deadlyPlatform1').setScale(element.scale).refreshBody().setDepth(2);
                    } else if (element.type === 'deadlyPlatform2') {
                        deadlyPlatforms2.create(element.x, element.y, 'deadlyPlatform2').setScale(element.scale).refreshBody().setDepth(2);
                    } else if (element.type === 'spike') {
                        spikes.create(element.x, element.y, 'spike').setScale(element.scale).refreshBody().setDepth(2);
                    } else if (element.type === 'coin') {
                        coins.create(element.x, element.y, 'coin').setScale(element.scale).setDepth(2);
                    } else if (element.type === 'start') {
                        player = this.physics.add.sprite(element.x, element.y, selectedSkin);
                        player.setScale(0.1);
                        player.setBounce(0.2);
                        player.setCollideWorldBounds(true);
                        player.body.setSize(player.width * 0.8, player.height * 0.8);
                        player.setDepth(3);
                    } else if (element.type === 'finish') {
                        finish = this.physics.add.staticSprite(element.x, element.y, 'finish').setScale(element.scale).refreshBody().setDepth(2);
                    }
                });
            } else {
                let deadlyPlatformType = null;
                if (isRandomLevel) {
                    deadlyPlatformType = Phaser.Math.Between(0, 1) === 0 ? 'deadlyPlatform1' : 'deadlyPlatform2';
                }

                if (isRandomLevel) {
                    const platformPositions = [];
                    for (let x = 0; x < 3000; x += 300) {
                        platformPositions.push({ x: x + 150, width: 300 });
                    }
                    platformPositions.forEach(pos => {
                        const isUnderPlayer = pos.x >= 300 && pos.x <= 500;
                        if (!isUnderPlayer) {
                            const shouldBeDeadly = Phaser.Math.Between(0, 100) < 30;
                            if (shouldBeDeadly && deadlyPlatformType) {
                                if (deadlyPlatformType === 'deadlyPlatform1') {
                                    deadlyPlatforms1.create(pos.x, 550, 'deadlyPlatform1').setScale(0.5).refreshBody().setDepth(2);
                                } else {
                                    deadlyPlatforms2.create(pos.x, 550, 'deadlyPlatform2').setScale(0.5).refreshBody().setDepth(2);
                                }
                            } else {
                                platforms.create(pos.x, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                            }
                        } else {
                            platforms.create(pos.x, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                        }
                    });
                } else {
                    if (currentLevel === 1) {
                        const positions = [150, 300, 450, 750, 900, 1050, 1350, 1650, 1950, 2250, 2550, 2850];
                        const deadlyPositions = [1050, 1650, 2250, 2550];
                        positions.forEach(x => {
                            if (deadlyPositions.includes(x)) {
                                deadlyPlatforms1.create(x, 550, 'deadlyPlatform1').setScale(0.5).refreshBody().setDepth(2);
                            } else {
                                platforms.create(x, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                            }
                        });
                    } else if (currentLevel === 2) {
                        const positions = [150, 450, 600, 750, 1050, 1200, 1350, 1650, 1950, 2250, 2550, 2850];
                        const deadlyPositions = [750, 1350, 1650, 2550];
                        positions.forEach(x => {
                            if (deadlyPositions.includes(x)) {
                                deadlyPlatforms1.create(x, 550, 'deadlyPlatform1').setScale(0.5).refreshBody().setDepth(2);
                            } else {
                                platforms.create(x, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                            }
                        });
                    } else if (currentLevel === 3) {
                        const positions = [150, 300, 450, 750, 900, 1050, 1350, 1500, 1650, 1950, 2250, 2550, 2850];
                        const deadlyPositions = [150, 1050, 1650, 2550];
                        positions.forEach(x => {
                            if (deadlyPositions.includes(x)) {
                                deadlyPlatforms2.create(x, 550, 'deadlyPlatform2').setScale(0.5).refreshBody().setDepth(2);
                            } else {
                                platforms.create(x, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                            }
                        });
                    } else if (currentLevel === 4) {
                        const positions = [150, 450, 600, 750, 1050, 1200, 1350, 1650, 1950, 2100, 2250, 2550, 2850];
                        const deadlyPositions = [150, 1350, 1950, 2250];
                        positions.forEach(x => {
                            if (deadlyPositions.includes(x)) {
                                deadlyPlatforms2.create(x, 550, 'deadlyPlatform2').setScale(0.5).refreshBody().setDepth(2);
                            } else {
                                platforms.create(x, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                            }
                        });
                    }
                }

                if (isRandomLevel) {
                    for (let i = 0; i < 8; i++) {
                        const x = Phaser.Math.Between(400, 2600);
                        const y = Phaser.Math.Between(200, 450);
                        platforms.create(x, y, 'platform').setScale(0.3).refreshBody().setDepth(2);
                    }
                } else {
                    if (currentLevel === 1) {
                        const upperPositions = [
                            { x: 600, y: 400 }, { x: 50, y: 250 }, { x: 1200, y: 300 },
                            { x: 1800, y: 400 }, { x: 2400, y: 350 }
                        ];
                        upperPositions.forEach(pos => {
                            platforms.create(pos.x, pos.y, 'platform').setScale(0.3).refreshBody().setDepth(2);
                        });
                    } else if (currentLevel === 2) {
                        const upperPositions = [
                            { x: 400, y: 350 }, { x: 800, y: 250 }, { x: 1400, y: 400 },
                            { x: 2000, y: 300 }, { x: 2600, y: 450 }
                        ];
                        upperPositions.forEach(pos => {
                            platforms.create(pos.x, pos.y, 'platform').setScale(0.3).refreshBody().setDepth(2);
                        });
                    } else if (currentLevel === 3) {
                        const upperPositions = [
                            { x: 400, y: 450 }, { x: 700, y: 350 }, { x: 1000, y: 250 },
                            { x: 1300, y: 400 }, { x: 1600, y: 300 }, { x: 1900, y: 450 },
                            { x: 2200, y: 350 }, { x: 2500, y: 250 }
                        ];
                        upperPositions.forEach(pos => {
                            platforms.create(pos.x, pos.y, 'platform').setScale(0.3).refreshBody().setDepth(2);
                        });
                    } else if (currentLevel === 4) {
                        const upperPositions = [
                            { x: 500, y: 450 }, { x: 900, y: 350 }, { x: 1300, y: 250 },
                            { x: 1700, y: 400 }, { x: 2500, y: 300 }
                        ];
                        upperPositions.forEach(pos => {
                            platforms.create(pos.x, pos.y, 'platform').setScale(0.3).refreshBody().setDepth(2);
                        });
                    }
                }

                let spikePositions = [];
                if (isRandomLevel) {
                    for (let i = 0; i < 5; i++) {
                        const x = Phaser.Math.Between(600, 2600);
                        spikes.create(x, 500, 'spike').setScale(0.2).refreshBody().setDepth(2);
                        spikePositions.push(x);
                    }
                } else {
                    if (currentLevel === 1) {
                        spikePositions = [800, 1000, 1500, 2000];
                        spikePositions.forEach(x => spikes.create(x, 500, 'spike').setScale(0.2).refreshBody().setDepth(2));
                    } else if (currentLevel === 2) {
                        spikePositions = [600, 1200, 1800, 2400];
                        spikePositions.forEach(x => spikes.create(x, 500, 'spike').setScale(0.2).refreshBody().setDepth(2));
                    } else if (currentLevel === 3) {
                        spikePositions = [600, 900, 1200, 1800];
                        spikePositions.forEach(x => spikes.create(x, 500, 'spike').setScale(0.2).refreshBody().setDepth(2));
                    } else if (currentLevel === 4) {
                        spikePositions = [700, 1100, 1600, 2600];
                        spikePositions.forEach(x => spikes.create(x, 500, 'spike').setScale(0.2).refreshBody().setDepth(2));
                    }
                }

                deadlyPlatforms1.getChildren().forEach(platform => {
                    const platformX = platform.x;
                    const platformY = platform.y;
                    if (platformY === 550 && spikePositions.some(spikeX => Math.abs(spikeX - platformX) < 50)) {
                        platform.destroy();
                        platforms.create(platformX, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                    }
                });
                deadlyPlatforms2.getChildren().forEach(platform => {
                    const platformX = platform.x;
                    const platformY = platform.y;
                    if (platformY === 550 && spikePositions.some(spikeX => Math.abs(spikeX - platformX) < 50)) {
                        platform.destroy();
                        platforms.create(platformX, 550, 'platform').setScale(0.5).refreshBody().setDepth(2);
                    }
                });

                if (isRandomLevel) {
                    for (let i = 0; i < 5; i++) {
                        const x = Phaser.Math.Between(400, 2600);
                        const y = Phaser.Math.Between(200, 450);
                        coins.create(x, y, 'coin').setScale(0.1).setDepth(2);
                    }
                } else {
                    if (currentLevel === 1) {
                        coins.create(600, 350, 'coin').setScale(0.1).setDepth(2);
                        coins.create(1200, 250, 'coin').setScale(0.1).setDepth(2);
                        coins.create(1800, 350, 'coin').setScale(0.1).setDepth(2);
                    } else if (currentLevel === 2) {
                        coins.create(400, 300, 'coin').setScale(0.1).setDepth(2);
                        coins.create(800, 200, 'coin').setScale(0.1).setDepth(2);
                        coins.create(2000, 250, 'coin').setScale(0.1).setDepth(2);
                    } else if (currentLevel === 3) {
                        coins.create(700, 300, 'coin').setScale(0.1).setDepth(2);
                        coins.create(1300, 350, 'coin').setScale(0.1).setDepth(2);
                        coins.create(2500, 200, 'coin').setScale(0.1).setDepth(2);
                    } else if (currentLevel === 4) {
                        coins.create(900, 300, 'coin').setScale(0.1).setDepth(2);
                        coins.create(1300, 200, 'coin').setScale(0.1).setDepth(2);
                        coins.create(1700, 350, 'coin').setScale(0.1).setDepth(2);
                    }
                }

                if (!customLevel) {
                    finish = this.physics.add.staticSprite(2800, 450, 'finish').setScale(0.2).refreshBody().setDepth(2);

                    player = this.physics.add.sprite(400, 450, selectedSkin);
                    player.setScale(0.1);
                    player.setBounce(0.2);
                    player.setCollideWorldBounds(true);
                    player.body.setSize(player.width * 0.8, player.height * 0.8);
                    player.setDepth(3);
                }
            }

            this.cameras.main.setBounds(0, 0, 3000, 600);
            if (!customLevel) {
                this.cameras.main.startFollow(player, true, 0.1, 0.1);
            } else {
                this.cameras.main.setScroll(0, 0);
                this.cameras.main.setZoom(1);
            }

            this.physics.add.collider(player, platforms, () => {
                jumpCount = 0;
                console.log("Коснулся платформы, jumpCount сброшен:", jumpCount);
            });
            this.physics.add.overlap(player, spikes, gameOver, null, this);
            this.physics.add.overlap(player, deadlyPlatforms1, gameOver, null, this);
            this.physics.add.overlap(player, deadlyPlatforms2, gameOver, null, this);
            this.physics.add.overlap(player, finish, winLevel, null, this);

            jumpCount = 0;
            startTime = this.time.now;

            buttonClickSound = this.sound.add('buttonClick', { volume: sfxVolume });
            gameOverSound = this.sound.add('gameOver', { volume: sfxVolume });
            winSound = this.sound.add('win', { volume: sfxVolume });
            jumpSound = this.sound.add('jumpSound', { volume: sfxVolume });
            coinSound = this.sound.add('coinSound', { volume: sfxVolume });

            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (skinMenuMusic && skinMenuMusic.isPlaying) skinMenuMusic.stop();
            if (editorMusic && editorMusic.isPlaying) editorMusic.stop();

            if (!backgroundMusic) {
                backgroundMusic = this.sound.add('levelMusic', { loop: true, volume: musicVolume });
            }
            if (!backgroundMusic.isPlaying) {
                backgroundMusic.play();
            }

            setupTouchControls(this);

            if (customLevel) {
                setupEditor(this);
            }

            if (customLevel) {
                this.input.on('wheel', (pointer, gameObjects, deltaX, deltaY, deltaZ) => {
                    this.cameras.main.scrollX += deltaY * 2;
                    this.cameras.main.scrollX = Phaser.Math.Clamp(this.cameras.main.scrollX, 0, 3000 - this.cameras.main.width);
                });
            }
        }

        let actionHistory = [];
        let historyIndex = -1;
        let gridEnabled = false;
        const GRID_SIZE = 32;

        function setupEditor(scene) {
            const elements = document.querySelectorAll('.element-image');
            let selectedElementType = null;
            let previewSprite = null;

            const gridOverlay = document.createElement('div');
            gridOverlay.className = 'grid-overlay';
            document.getElementById('game-container').appendChild(gridOverlay);

            document.getElementById('toggle-grid-btn').addEventListener('click', () => {
                gridEnabled = !gridEnabled;
                gridOverlay.style.display = gridEnabled ? 'block' : 'none';
                console.log('Сетка:', gridEnabled ? 'включена' : 'выключена');
            });

            elements.forEach(element => {
                element.addEventListener('click', () => {
                    selectedElementType = element.dataset.type;
                    console.log('Выбран элемент:', selectedElementType);
                    elements.forEach(el => el.style.borderColor = 'white');
                    element.style.borderColor = 'yellow';
                });
            });

            scene.input.on('pointermove', (pointer) => {
                if (!selectedElementType) return;

                const worldPoint = scene.cameras.main.getWorldPoint(pointer.x, pointer.y);
                let x = worldPoint.x;
                let y = worldPoint.y;

                if (gridEnabled) {
                    x = Math.round(x / GRID_SIZE) * GRID_SIZE;
                    y = Math.round(y / GRID_SIZE) * GRID_SIZE;
                }

                if (!previewSprite) {
                    previewSprite = scene.add.sprite(x, y, selectedElementType).setAlpha(0.5).setDepth(10);
                    let scale = 0.5;
                    if (selectedElementType === 'coin' || selectedElementType === 'start') scale = 0.1;
                    if (selectedElementType === 'spike' || selectedElementType === 'finish') scale = 0.2;
                    previewSprite.setScale(scale);
                } else {
                    previewSprite.setPosition(x, y);
                }

                const startElement = levelData.elements.find(el => el.type === 'start');
                if (startElement) {
                    const distance = Phaser.Math.Distance.Between(x, y, startElement.x, startElement.y);
                    if (distance < 50) {
                        previewSprite.setTint(0xff0000);
                    } else {
                        previewSprite.clearTint();
                    }
                }
            });

            scene.input.on('pointerdown', (pointer) => {
                if (!selectedElementType) return;

                if (pointer.rightButtonDown()) {
                    const worldPoint = scene.cameras.main.getWorldPoint(pointer.x, pointer.y);
                    const x = worldPoint.x;
                    const y = worldPoint.y;

                    let closestElement = null;
                    let minDistance = Infinity;
                    levelData.elements.forEach((element, index) => {
                        const distance = Phaser.Math.Distance.Between(x, y, element.x, element.y);
                        if (distance < minDistance && distance < 50) {
                            minDistance = distance;
                            closestElement = index;
                        }
                    });

                    if (closestElement !== null) {
                        levelData.elements.splice(closestElement, 1);
                        actionHistory = actionHistory.slice(0, historyIndex + 1);
                        actionHistory.push(JSON.parse(JSON.stringify(levelData.elements)));
                        historyIndex++;
                        scene.scene.restart();
                        console.log('Элемент удалён');
                    }
                    return;
                }

                const worldPoint = scene.cameras.main.getWorldPoint(pointer.x, pointer.y);
                let x = worldPoint.x;
                let y = worldPoint.y;

                if (gridEnabled) {
                    x = Math.round(x / GRID_SIZE) * GRID_SIZE;
                    y = Math.round(y / GRID_SIZE) * GRID_SIZE;
                }

                const startElement = levelData.elements.find(el => el.type === 'start');
                if (startElement) {
                    const distance = Phaser.Math.Distance.Between(x, y, startElement.x, startElement.y);
                    if (distance < 50) {
                        console.log('Нельзя размещать элемент рядом со стартовой точкой!');
                        return;
                    }
                }

                let scale = 0.5;
                if (selectedElementType === 'coin' || selectedElementType === 'start') scale = 0.1;
                if (selectedElementType === 'spike' || selectedElementType === 'finish') scale = 0.2;

                levelData.elements.push({
                    type: selectedElementType,
                    x: x,
                    y: y,
                    scale: scale
                });

                actionHistory = actionHistory.slice(0, historyIndex + 1);
                actionHistory.push(JSON.parse(JSON.stringify(levelData.elements)));
                historyIndex++;

                if (selectedElementType === 'platform') {
                    scene.platforms.create(x, y, 'platform').setScale(scale).refreshBody().setDepth(2);
                } else if (selectedElementType === 'deadlyPlatform1') {
                    scene.deadlyPlatforms1.create(x, y, 'deadlyPlatform1').setScale(scale).refreshBody().setDepth(2);
                } else if (selectedElementType === 'deadlyPlatform2') {
                    scene.deadlyPlatforms2.create(x, y, 'deadlyPlatform2').setScale(scale).refreshBody().setDepth(2);
                } else if (selectedElementType === 'spike') {
                    scene.spikes.create(x, y, 'spike').setScale(scale).refreshBody().setDepth(2);
                } else if (selectedElementType === 'coin') {
                    scene.coins.create(x, y, 'coin').setScale(scale).setDepth(2);
                } else if (selectedElementType === 'start') {
                    if (scene.player) scene.player.destroy();
                    scene.player = scene.physics.add.sprite(x, y, selectedSkin);
                    scene.player.setScale(0.1);
                    scene.player.setBounce(0.2);
                    scene.player.setCollideWorldBounds(true);
                    scene.player.body.setSize(scene.player.width * 0.8, scene.player.height * 0.8);
                    scene.player.setDepth(3);
                } else if (selectedElementType === 'finish') {
                    if (scene.finish) scene.finish.destroy();
                    scene.finish = scene.physics.add.staticSprite(x, y, 'finish').setScale(scale).refreshBody().setDepth(2);
                }

                console.log(`Элемент ${selectedElementType} размещён на координатах: x=${x}, y=${y}`);
            });

            scene.input.on('pointerout', () => {
                if (previewSprite) {
                    previewSprite.destroy();
                    previewSprite = null;
                }
            });

            document.getElementById('undo-btn').addEventListener('click', () => {
                if (historyIndex > 0) {
                    historyIndex--;
                    levelData.elements = JSON.parse(JSON.stringify(actionHistory[historyIndex]));
                    scene.scene.restart();
                    console.log('Действие отменено');
                }
            });

            document.getElementById('redo-btn').addEventListener('click', () => {
                if (historyIndex < actionHistory.length - 1) {
                    historyIndex++;
                    levelData.elements = JSON.parse(JSON.stringify(actionHistory[historyIndex]));
                    scene.scene.restart();
                    console.log('Действие повторено');
                }
            });

            document.getElementById('clear-all-btn').addEventListener('click', () => {
                levelData.elements = [];
                actionHistory = [];
                historyIndex = -1;
                scene.scene.restart();
                console.log('Уровень очищен');
            });
        }

        function update() {
            if (!gameStarted) return;

            if (customLevel) {
                const cursors = this.input.keyboard.createCursorKeys();
                if (cursors.left.isDown) {
                    this.cameras.main.scrollX -= 5;
                } else if (cursors.right.isDown) {
                    this.cameras.main.scrollX += 5;
                }

                if (cursors.up.isDown) {
                    this.cameras.main.zoom += 0.01;
                } else if (cursors.down.isDown) {
                    this.cameras.main.zoom -= 0.01;
                }
                this.cameras.main.zoom = Phaser.Math.Clamp(this.cameras.main.zoom, 0.5, 2);

                this.cameras.main.scrollX = Phaser.Math.Clamp(this.cameras.main.scrollX, 0, 3000 - this.cameras.main.width);
            } else {
                const cursors = this.input.keyboard.createCursorKeys();

                if (cursors.left.isDown || isTouchingLeft) {
                    player.setVelocityX(-160);
                } else if (cursors.right.isDown || isTouchingRight) {
                    player.setVelocityX(160);
                } else {
                    player.setVelocityX(0);
                }

                if ((cursors.up.isDown || isTouchingJump) && !isJumping && jumpCount < maxJumps) {
                    player.setVelocityY(-330);
                    jumpCount++;
                    isJumping = true;
                    if (jumpSound) jumpSound.play();
                    console.log("Прыжок! jumpCount:", jumpCount);
                }

                if (!cursors.up.isDown && !isTouchingJump) {
                    isJumping = false;
                }

                checkCoinOverlap(player, coins);
            }
        }

        let isTouchingLeft = false;
        let isTouchingRight = false;
        let isTouchingJump = false;

        function setupTouchControls(scene) {
            const leftButton = document.getElementById('leftButton');
            const rightButton = document.getElementById('rightButton');
            const jumpButton = document.getElementById('jumpButton');

            leftButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouchingLeft = true;
            });
            leftButton.addEventListener('touchend', () => {
                isTouchingLeft = false;
            });

            rightButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouchingRight = true;
            });
            rightButton.addEventListener('touchend', () => {
                isTouchingRight = false;
            });

            jumpButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouchingJump = true;
            });
            jumpButton.addEventListener('touchend', () => {
                isTouchingJump = false;
            });
        }

        function gameOver(player, hazard) {
            this.physics.pause();
            gameStarted = false;
            if (backgroundMusic && backgroundMusic.isPlaying) backgroundMusic.stop();
            if (gameOverSound) gameOverSound.play();
            document.getElementById('game-over').style.display = 'flex';
        }

        function winLevel(player, finish) {
            this.physics.pause();
            gameStarted = false;
            if (backgroundMusic && backgroundMusic.isPlaying) backgroundMusic.stop();
            if (winSound) winSound.play();
            elapsedTime = (this.time.now - startTime) / 1000;
            document.getElementById('time-display').innerText = `Время: ${elapsedTime.toFixed(2)} сек`;
            document.getElementById('coins-display').innerText = `Собрано монет: ${collectedCoins}`;
            document.getElementById('win-screen').style.display = 'flex';
        }

        function restartLevel() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('game-over').style.display = 'none';
            gameStarted = true;
            const savedLevel = currentLevel;
            const savedIsRandomLevel = isRandomLevel;
            const savedCustomLevel = customLevel;
            game.scene.scenes[0].scene.restart();
            currentLevel = savedLevel;
            isRandomLevel = savedIsRandomLevel;
            customLevel = savedCustomLevel;
            console.log(`Перезапуск уровня: currentLevel=${currentLevel}, isRandomLevel=${isRandomLevel}, customLevel=${customLevel}`);
        }

        function returnToMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('win-screen').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('about-menu').style.display = 'none';
            document.getElementById('skin-menu').style.display = 'none';
            document.getElementById('create-level-menu').style.display = 'none';
            document.getElementById('level-name-menu').style.display = 'none';
            document.getElementById('background-menu').style.display = 'none';
            document.getElementById('level-editor').style.display = 'none';
            gameStarted = false;
            isRandomLevel = false;
            customLevel = false;
            if (backgroundMusic && backgroundMusic.isPlaying) backgroundMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (skinMenuMusic && skinMenuMusic.isPlaying) skinMenuMusic.stop();
            if (editorMusic && editorMusic.isPlaying) editorMusic.stop();
            if (!menuMusic) {
                menuMusic = game.sound.add('menuMusic', { loop: true, volume: musicVolume });
            }
            if (!menuMusic.isPlaying) {
                menuMusic.play();
            }
        }

        function startLevel(level) {
            if (buttonClickSound) buttonClickSound.play();
            currentLevel = level;
            isRandomLevel = false;
            customLevel = false;
            gameStarted = true;
            document.getElementById('menu').style.display = 'none';
            game.scene.scenes[0].scene.restart();
        }

        function startRandomLevel() {
            if (buttonClickSound) buttonClickSound.play();
            isRandomLevel = true;
            customLevel = false;
            gameStarted = true;
            document.getElementById('menu').style.display = 'none';
            game.scene.scenes[0].scene.restart();
        }

        function openSkinMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('skin-menu').style.display = 'flex';
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (!skinMenuMusic) {
                skinMenuMusic = game.sound.add('skinMenuMusic', { loop: true, volume: musicVolume });
            }
            if (!skinMenuMusic.isPlaying) {
                skinMenuMusic.play();
            }
        }

        function selectSkin(skin) {
            if (buttonClickSound) buttonClickSound.play();
            selectedSkin = skin;
            console.log(`Выбран скин: ${skin}`);
            backToMenu();
        }

        function openSettings() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('settings-menu').style.display = 'flex';
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (skinMenuMusic && skinMenuMusic.isPlaying) skinMenuMusic.stop();
            if (!settingsMusic) {
                settingsMusic = game.sound.add('settingsMusic', { loop: true, volume: musicVolume });
            }
            if (!settingsMusic.isPlaying) {
                settingsMusic.play();
            }
        }

        function openAbout() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('about-menu').style.display = 'flex';
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (skinMenuMusic && skinMenuMusic.isPlaying) skinMenuMusic.stop();
            if (!aboutMusic) {
                aboutMusic = game.sound.add('aboutMusic', { loop: true, volume: musicVolume });
            }
            if (!aboutMusic.isPlaying) {
                aboutMusic.play();
            }
        }

        function backToMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('about-menu').style.display = 'none';
            document.getElementById('skin-menu').style.display = 'none';
            document.getElementById('create-level-menu').style.display = 'none';
            document.getElementById('level-name-menu').style.display = 'none';
            document.getElementById('background-menu').style.display = 'none';
            document.getElementById('level-editor').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            gameStarted = false;
            customLevel = false;
            if (settingsMusic && settingsMusic.isPlaying) settingsMusic.stop();
            if (aboutMusic && aboutMusic.isPlaying) aboutMusic.stop();
            if (skinMenuMusic && skinMenuMusic.isPlaying) skinMenuMusic.stop();
            if (editorMusic && editorMusic.isPlaying) editorMusic.stop();
            if (!menuMusic) {
                menuMusic = game.sound.add('menuMusic', { loop: true, volume: musicVolume });
            }
            if (!menuMusic.isPlaying) {
                menuMusic.play();
            }
        }

        function openCreateLevelMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('create-level-menu').style.display = 'flex';
            if (menuMusic && menuMusic.isPlaying) menuMusic.stop();
            if (!editorMusic) {
                editorMusic = game.sound.add('editorMusic', { loop: true, volume: musicVolume });
            }
            if (!editorMusic.isPlaying) {
                editorMusic.play();
            }
        }

        function openLevelNameMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('create-level-menu').style.display = 'none';
            document.getElementById('level-name-menu').style.display = 'flex';
        }

        function backToLevelNameMenu() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('background-menu').style.display = 'none';
            document.getElementById('level-name-menu').style.display = 'flex';
        }

        function openBackgroundMenu() {
            if (buttonClickSound) buttonClickSound.play();
            levelName = document.getElementById('level-name-input').value || 'Без названия';
            document.getElementById('level-name-menu').style.display = 'none';
            document.getElementById('background-menu').style.display = 'flex';
        }

        function selectBackground(background) {
            if (buttonClickSound) buttonClickSound.play();
            selectedBackground = background;
            levelData.background = background;
            openLevelEditor();
        }

        function openLevelEditor() {
            if (buttonClickSound) buttonClickSound.play();
            document.getElementById('background-menu').style.display = 'none';
            document.getElementById('level-editor').style.display = 'flex';
            gameStarted = true;
            customLevel = true;
            levelData.elements = [];
            actionHistory = [];
            historyIndex = -1;
            game.scene.scenes[0].scene.restart();
            if (!editorMusic.isPlaying) {
                editorMusic.play();
            }
        }

        function copyLevelCode() {
            if (buttonClickSound) buttonClickSound.play();
            levelCode = btoa(JSON.stringify(levelData));
            navigator.clipboard.writeText(levelCode).then(() => {
                alert('Код уровня скопирован в буфер обмена!');
            });
        }

        function loadLevelFromCode() {
            if (buttonClickSound) buttonClickSound.play();
            const code = document.getElementById('level-code-input').value;
            if (code) {
                try {
                    levelData = JSON.parse(atob(code));
                    customLevel = true;
                    gameStarted = true;
                    document.getElementById('create-level-menu').style.display = 'none';
                    game.scene.scenes[0].scene.restart();
                } catch (e) {
                    alert('Неверный код уровня!');
                }
            } else {
                alert('Введите код уровня!');
            }
        }

        function adjustMusicVolume(value) {
            musicVolume = parseFloat(value);
            if (menuMusic) menuMusic.setVolume(musicVolume);
            if (backgroundMusic) backgroundMusic.setVolume(musicVolume);
            if (settingsMusic) settingsMusic.setVolume(musicVolume);
            if (aboutMusic) aboutMusic.setVolume(musicVolume);
            if (skinMenuMusic) skinMenuMusic.setVolume(musicVolume);
            if (editorMusic) editorMusic.setVolume(musicVolume);
        }

        function adjustSfxVolume(value) {
            sfxVolume = parseFloat(value);
            if (buttonClickSound) buttonClickSound.setVolume(sfxVolume);
            if (gameOverSound) gameOverSound.setVolume(sfxVolume);
            if (winSound) winSound.setVolume(sfxVolume);
            if (jumpSound) jumpSound.setVolume(sfxVolume);
            if (coinSound) coinSound.setVolume(sfxVolume);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('level1-btn').addEventListener('click', () => startLevel(1));
            document.getElementById('level2-btn').addEventListener('click', () => startLevel(2));
            document.getElementById('level3-btn').addEventListener('click', () => startLevel(3));
            document.getElementById('level4-btn').addEventListener('click', () => startLevel(4));
            document.getElementById('random-level-btn').addEventListener('click', startRandomLevel);
            document.getElementById('create-level-btn').addEventListener('click', openCreateLevelMenu);
            document.getElementById('skin-menu-btn').addEventListener('click', openSkinMenu);
            document.getElementById('settings-btn').addEventListener('click', openSettings);

            document.getElementById('music-volume').addEventListener('input', (e) => adjustMusicVolume(e.target.value));
            document.getElementById('sfx-volume').addEventListener('input', (e) => adjustSfxVolume(e.target.value));
            document.getElementById('about-btn').addEventListener('click', openAbout);
            document.getElementById('settings-back-btn').addEventListener('click', backToMenu);

            document.getElementById('about-back-btn').addEventListener('click', backToMenu);

            document.getElementById('skin1-btn').addEventListener('click', () => selectSkin('pineapple1'));
            document.getElementById('skin2-btn').addEventListener('click', () => selectSkin('pineapple2'));
            document.getElementById('skin3-btn').addEventListener('click', () => selectSkin('pineapple3'));
            document.getElementById('skin4-btn').addEventListener('click', () => selectSkin('pineapple4'));
            document.getElementById('skin-back-btn').addEventListener('click', backToMenu);

            document.getElementById('load-level-btn').addEventListener('click', loadLevelFromCode);
            document.getElementById('new-level-btn').addEventListener('click', openLevelNameMenu);
            document.getElementById('create-level-back-btn').addEventListener('click', backToMenu);

            document.getElementById('level-name-next-btn').addEventListener('click', openBackgroundMenu);
            document.getElementById('level-name-back-btn').addEventListener('click', backToMenu);

            document.getElementById('bg1-btn').addEventListener('click', () => selectBackground('background1'));
            document.getElementById('bg2-btn').addEventListener('click', () => selectBackground('background2'));
            document.getElementById('bg3-btn').addEventListener('click', () => selectBackground('background3'));
            document.getElementById('bg4-btn').addEventListener('click', () => selectBackground('background4'));
            document.getElementById('bg-back-btn').addEventListener('click', backToLevelNameMenu);

            document.getElementById('editor-menu-btn').addEventListener('click', backToMenu);
            document.getElementById('copy-code-btn').addEventListener('click', copyLevelCode);

            document.getElementById('restart-btn').addEventListener('click', restartLevel);
            document.getElementById('return-to-menu-btn').addEventListener('click', returnToMenu);
        });
    </script>
</body>
</html>